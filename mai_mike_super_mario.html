<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MAI_MIKE - Super Mario</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    canvas {
      border: 4px solid white;
    }
    h1 {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <h1>MAI_MIKE - Super Mario</h1>
  <canvas id="game" width="512" height="480"></canvas>
  <script>
    // 加载经典 Super Mario Bros (NES) 模拟器
    // 使用 jsnes（JavaScript NES 模拟器） + ROM 嵌入

    const script = document.createElement('script');
    script.src = 'https://unpkg.com/jsnes@0.8.0/dist/jsnes.min.js';
    script.onload = () => {
      const canvas = document.getElementById('game');
      const context = canvas.getContext('2d');

      const nes = new jsnes.NES({
        onFrame: function(frameBuffer) {
          const imageData = context.createImageData(256, 240);
          for (let i = 0; i < frameBuffer.length; i++) {
            imageData.data[i * 4 + 0] = (frameBuffer[i] >> 16) & 0xFF;
            imageData.data[i * 4 + 1] = (frameBuffer[i] >> 8) & 0xFF;
            imageData.data[i * 4 + 2] = frameBuffer[i] & 0xFF;
            imageData.data[i * 4 + 3] = 0xFF;
          }
          context.putImageData(imageData, 0, 0);
        },
        onAudioSample: () => {}
      });

      // 键盘控制器
      const keys = {
        ArrowUp: jsnes.Controller.BUTTON_UP,
        ArrowDown: jsnes.Controller.BUTTON_DOWN,
        ArrowLeft: jsnes.Controller.BUTTON_LEFT,
        ArrowRight: jsnes.Controller.BUTTON_RIGHT,
        KeyZ: jsnes.Controller.BUTTON_A,
        KeyX: jsnes.Controller.BUTTON_B,
        Enter: jsnes.Controller.BUTTON_START,
        ShiftLeft: jsnes.Controller.BUTTON_SELECT,
      };

      window.addEventListener('keydown', (e) => {
        if (keys[e.code]) nes.buttonDown(1, keys[e.code]);
      });
      window.addEventListener('keyup', (e) => {
        if (keys[e.code]) nes.buttonUp(1, keys[e.code]);
      });

      // 加载 ROM
      fetch('https://cdn.jsdelivr.net/gh/bfirsh/jsnes-roms@master/smb.nes')
        .then(r => r.arrayBuffer())
        .then(buffer => nes.loadROM(new Uint8Array(buffer)))
        .then(() => nes.start());
    };
    document.head.appendChild(script);
  </script>
</body>
</html>
